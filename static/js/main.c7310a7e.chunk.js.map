{"version":3,"sources":["draw-elements-drawer/DrawElementConfig.ts","draw-elements sync //.element/.ts$","draw-elements/Line.element.ts","draw-elements/Rect.element.ts","draw-elements-drawer/get-draw-element-config-registry.ts","global-id.ts","Island.tsx","state-history.ts","App.tsx","reportWebVitals.ts","index.tsx","freehand-draw.ts","draw-elements/Draw.element.ts"],"names":["BoundingBoxTable","WeakMap","createDrawElementConfig","config","resultConfig","__TYPE__","getBoundingBox","element","has","set","get","containsPoint","point","rect","x","y","width","height","isDrawElementConfig","obj","Reflect","map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","name","draw","line","ctx","lineWidth","strokeStyle","color","beginPath","moveTo","x0","y0","lineTo","x1","y1","stroke","onCreate","onDrawing","dx","dy","Math","min","abs","max","strokeColor","fillStyle","backgroundColor","fill","drawElementConfigRegistry","getAllDrawElementConfigs","r","require","TypeError","assertDrawElementConfigModule","Island","props","className","children","linkedListNode","value","prev","next","StateHistory","maxLength","this","newNode","reduce","acc","drawElementConfig","elementTypes","initialState","drawElements","draftElement","selectedElement","hoveredElement","activeTool","scrollPoint","updateScrollPoint","scrollPointShift","type","setDrawElements","appReducer","state","action","drawElement","concat","tool","ORIGINAL_CURSOR_STYLE","App","canvasRef","useRef","useReducer","dispatch","history","useState","of","hasNext","setHasNext","hasPrev","setHasPrev","useEffect","push","goBack","goForward","useHistory","lastState","current","resizeCanvas","canvas","dpr","window","devicePixelRatio","innerWidth","innerHeight","style","getContext","scale","drawScene","addEventListener","removeEventListener","useCanvasAutoResize","draftElementRef","activeElementConfig","lastClientX","lastClientY","handlePointerDown","ev","target","preventDefault","clientX","clientY","buttons","document","handlePointerMoveWhileDragging","handlePointerUpWhileDragging","Date","now","toString","handlePointerMoveWhileDrawing","handlePointerUpWhileDrawing","cursor","handlePointerMoveWhileScrolling","handlePointerUpWhileScrolling","shift","handleWheel","deltaX","deltaY","elementType","disabled","onClick","ref","onMouseMove","i","length","getDrawElementAtPoint","scrollX","scrollY","clearRect","translate","forEach","save","boundingBox","setLineDash","BOUNDING_BOX_LINE_DASH","strokeRect","BOUNDING_BOX_DELTA","restore","drawBoundingBox","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById","freehandDraw","points","pathData","d","arr","join","getSvgPathFromStroke","getStroke","Path2D","p"],"mappings":"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","file":"static/js/main.c7310a7e.chunk.js","sourcesContent":["import {\n  DrawElementByType,\n  DrawElementType,\n} from \"../draw-elements/DrawElements\";\nimport { Point2D } from \"../Point2D\";\nimport { DrawElementsDrawer } from \"./DrawElementsDrawer\";\n\ntype BoundingBox = {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n};\n\nexport interface DrawElementConfig<Type extends DrawElementType> {\n  name: Type;\n  draw: DrawElementsDrawer<Type>;\n  onCreate(x: number, y: number): DrawElementByType<Type>;\n  onDrawing(\n    dx: number,\n    dy: number,\n    element: DrawElementByType<Type>\n  ): Partial<DrawElementByType<Type>>;\n  getBoundingBox(element: DrawElementByType<Type>): BoundingBox;\n  containsPoint(element: DrawElementByType<Type>, point: Point2D): boolean;\n}\n\nconst BoundingBoxTable = new WeakMap<\n  DrawElementByType<DrawElementType>,\n  BoundingBox\n>();\n\nconst CONTAINS_THRESHOLD = 10;\n\nexport function createDrawElementConfig<Type extends DrawElementType>(\n  config: DrawElementConfig<Type>\n): DrawElementConfig<Type> & { __TYPE__: \"DrawElementConfig\" } {\n  const resultConfig: DrawElementConfig<Type> & {\n    __TYPE__: \"DrawElementConfig\";\n  } = {\n    ...config,\n    __TYPE__: \"DrawElementConfig\",\n    getBoundingBox(element: DrawElementByType<Type>): BoundingBox {\n      if (!BoundingBoxTable.has(element)) {\n        BoundingBoxTable.set(element, config.getBoundingBox(element));\n      }\n      return BoundingBoxTable.get(element)!;\n    },\n    containsPoint(element: DrawElementByType<Type>, point: Point2D): boolean {\n      const rect = resultConfig.getBoundingBox(element);\n      const [x, y] = point;\n      const isInsideRect =\n        rect.x - CONTAINS_THRESHOLD <= x &&\n        rect.x + rect.width + CONTAINS_THRESHOLD >= x &&\n        rect.y - CONTAINS_THRESHOLD <= y &&\n        rect.y + rect.height + CONTAINS_THRESHOLD >= y;\n      if (isInsideRect) {\n        return config.containsPoint(element, point);\n      }\n      return false;\n    },\n  };\n  return resultConfig;\n}\n\nexport function isDrawElementConfig(\n  obj: unknown\n): obj is DrawElementConfig<DrawElementType> {\n  return (\n    typeof obj === \"object\" &&\n    obj != null &&\n    Reflect.get(obj, \"__TYPE__\") === \"DrawElementConfig\"\n  );\n}\n","var map = {\n\t\"./Draw.element.ts\": 27,\n\t\"./Line.element.ts\": 22,\n\t\"./Rect.element.ts\": 23\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 21;","import { createDrawElementConfig } from \"../draw-elements-drawer/DrawElementConfig\";\n\nexport interface Line {\n  color: string;\n  x0: number;\n  y0: number;\n  x1: number;\n  y1: number;\n}\n\ndeclare module \"./DrawElements\" {\n  interface DrawElements {\n    Line: Line;\n  }\n}\n\nexport const config = createDrawElementConfig({\n  name: \"Line\",\n  draw(line, ctx) {\n    ctx.lineWidth = 4;\n    ctx.strokeStyle = line.color;\n    ctx.beginPath();\n    ctx.moveTo(line.x0, line.y0);\n    ctx.lineTo(line.x1, line.y1);\n    ctx.stroke();\n  },\n  onCreate(x: number, y: number) {\n    return {\n      color: \"#000000\",\n      x0: x,\n      y0: y,\n      x1: x,\n      y1: y,\n    };\n  },\n  onDrawing(dx: number, dy: number, line: Line) {\n    return {\n      x1: line.x1 + dx,\n      y1: line.y1 + dy,\n    };\n  },\n  getBoundingBox(line: Line) {\n    return {\n      x: Math.min(line.x0, line.x1),\n      y: Math.min(line.y0, line.y1),\n      width: Math.abs(line.x0 - line.x1),\n      height: Math.abs(line.y0 - line.y1),\n    };\n  },\n  containsPoint(line, [x, y]) {\n    return (\n      Math.min(line.x0, line.x1) <= x &&\n      Math.max(line.x0, line.x1) >= x &&\n      Math.min(line.y0, line.y1) <= y &&\n      Math.max(line.y0, line.y1) >= y\n    );\n  },\n});\n","import { createDrawElementConfig } from \"../draw-elements-drawer/DrawElementConfig\";\n\nexport interface Rect {\n  strokeColor: string;\n  backgroundColor: string;\n  x0: number;\n  y0: number;\n  x1: number;\n  y1: number;\n}\n\ndeclare module \"./DrawElements\" {\n  interface DrawElements {\n    Rect: Rect;\n  }\n}\n\nconst CONTAINS_THRESHOLD = 4;\n\nexport const config = createDrawElementConfig({\n  name: \"Rect\",\n  draw(rect, ctx) {\n    ctx.lineWidth = 4;\n    ctx.strokeStyle = rect.strokeColor;\n    ctx.fillStyle = rect.backgroundColor;\n    ctx.beginPath();\n    ctx.rect(rect.x0, rect.y0, rect.x1 - rect.x0, rect.y1 - rect.y0);\n    ctx.fill();\n    ctx.stroke();\n  },\n  onCreate(x, y) {\n    return {\n      backgroundColor: \"transparent\",\n      strokeColor: \"black\",\n      x0: x,\n      y0: y,\n      x1: x,\n      y1: y,\n    };\n  },\n  onDrawing(dx, dy, rect) {\n    return {\n      x1: rect.x1 + dx,\n      y1: rect.y1 + dy,\n    };\n  },\n  getBoundingBox(rect) {\n    return {\n      x: Math.min(rect.x0, rect.x1),\n      y: Math.min(rect.y0, rect.y1),\n      width: Math.abs(rect.x1 - rect.x0),\n      height: Math.abs(rect.y1 - rect.y0),\n    };\n  },\n  containsPoint(rect, [x, y]) {\n    return (\n      Math.min(rect.x0, rect.x1) - CONTAINS_THRESHOLD <= x &&\n      Math.max(rect.x0, rect.x1) + CONTAINS_THRESHOLD >= x &&\n      Math.min(rect.y0, rect.y1) - CONTAINS_THRESHOLD <= y &&\n      Math.max(rect.y0, rect.y1) + CONTAINS_THRESHOLD >= y\n    );\n  },\n});\n","import { DrawElementType } from \"../draw-elements/DrawElements\";\nimport { DrawElementConfig, isDrawElementConfig } from \"./DrawElementConfig\";\n\nfunction importAll(r: __WebpackModuleApi.RequireContext) {\n  return r.keys().map(r);\n}\n\nfunction assertDrawElementConfigModule(\n  module: unknown\n): asserts module is { config: DrawElementConfig<any> } {\n  if (\n    typeof module !== \"object\" ||\n    module == null ||\n    !isDrawElementConfig(Reflect.get(module, \"config\"))\n  ) {\n    throw new TypeError(\n      \"*.element.ts files must be a module exporting `config` object\"\n    );\n  }\n}\n\nfunction getAllDrawElementConfigs(): DrawElementConfig<DrawElementType>[] {\n  return importAll(\n    require.context(\"../draw-elements/\", true, /\\.element\\.ts$/)\n  ).map((module) => {\n    assertDrawElementConfigModule(module);\n    return module.config;\n  });\n}\n\nlet drawElementConfigRegistry: Record<DrawElementType, DrawElementConfig<any>>;\n\nexport function getDrawElementConfigRegistry() {\n  if (drawElementConfigRegistry != null) {\n    return drawElementConfigRegistry;\n  }\n\n  drawElementConfigRegistry = getAllDrawElementConfigs().reduce(\n    (acc, drawElementConfig) => {\n      acc[drawElementConfig.name] = drawElementConfig;\n      return acc;\n    },\n    {} as Record<DrawElementType, DrawElementConfig<any>>\n  );\n\n  return drawElementConfigRegistry;\n}\n","export type GlobalId = string & { __TYPE__: \"GlobalId\" };\n\nlet id = 0;\nexport function getId(): GlobalId {\n  id++;\n  return (Date.now() + id).toString(32) as GlobalId;\n}\n","import { ReactNode } from \"react\";\n\nimport \"./Island.css\";\n\nexport function Island(props: { children: ReactNode; className?: string }) {\n  return (\n    <div className={\"Island\" + (props.className ? ` ${props.className}` : \"\")}>\n      {props.children}\n    </div>\n  );\n}\n","interface LinkedListNode<T> {\n  value: T;\n  next: LinkedListNode<T> | null;\n  prev: LinkedListNode<T> | null;\n}\n\nfunction linkedListNode<T>(\n  value: T,\n  prev: LinkedListNode<T> | null = null,\n  next: LinkedListNode<T> | null = null\n): LinkedListNode<T> {\n  return {\n    value,\n    next,\n    prev,\n  };\n}\n\nexport class StateHistory<T> {\n  public static of<T>(value: T, maxLength = 100) {\n    return new StateHistory(value, maxLength);\n  }\n\n  #maxLength: number;\n\n  #size = 1;\n\n  #head: LinkedListNode<T>;\n\n  #curNode: LinkedListNode<T>;\n\n  private constructor(value: T, maxLength: number) {\n    this.#head = this.#curNode = linkedListNode(value);\n    this.#maxLength = maxLength;\n  }\n\n  public get(): T {\n    return this.#curNode.value;\n  }\n\n  public push(value: T) {\n    const newNode = linkedListNode(value, this.#curNode);\n    this.#curNode.next = newNode;\n    this.#curNode = newNode;\n    this.#size++;\n\n    while (this.#size > this.#maxLength && this.#head.next) {\n      if (this.#curNode === this.#head && this.#curNode.next) {\n        this.#curNode = this.#curNode.next;\n        this.#curNode.prev = null;\n      }\n      this.#head = this.#head.next;\n      this.#head.prev = null;\n      this.#size--;\n    }\n\n    return this;\n  }\n\n  public goBack() {\n    if (this.#curNode.prev != null) {\n      this.#curNode = this.#curNode.prev;\n      this.#size--;\n    }\n    return this;\n  }\n\n  public goForward() {\n    if (this.#curNode.next != null) {\n      this.#curNode = this.#curNode.next;\n      this.#size++;\n    }\n    return this;\n  }\n\n  public hasPrev() {\n    return this.#curNode.prev != null;\n  }\n\n  public hasNext() {\n    return this.#curNode.next != null;\n  }\n}\n","import { RefObject, useEffect, useReducer, useRef, useState } from \"react\";\nimport {\n  DrawElementByType,\n  DrawElements,\n  DrawElementType,\n} from \"./draw-elements/DrawElements\";\nimport \"./App.css\";\nimport { getDrawElementConfigRegistry } from \"./draw-elements-drawer/get-draw-element-config-registry\";\nimport { getId, GlobalId } from \"./global-id\";\nimport { Island } from \"./Island\";\nimport { StateHistory } from \"./state-history\";\nimport { Point2D } from \"./Point2D\";\n\ninterface DrawElement<Type extends keyof DrawElements = DrawElementType> {\n  type: Type;\n  id: GlobalId;\n  props: DrawElements[Type];\n}\n\nconst drawElementConfigRegistry = getDrawElementConfigRegistry();\n\nconst elementTypes = Object.keys(\n  drawElementConfigRegistry\n) as DrawElementType[];\n\ninterface AppState {\n  drawElements: DrawElement[];\n  draftElement: DrawElement | null;\n  selectedElement: DrawElement | null;\n  hoveredElement: DrawElement | null;\n  activeTool: DrawElementType;\n  scrollPoint: Point2D;\n}\n\nconst initialState: AppState = {\n  drawElements: [],\n  draftElement: null,\n  selectedElement: null,\n  hoveredElement: null,\n  activeTool: elementTypes[0],\n  scrollPoint: [0, 0],\n};\n\nfunction createDraftElement(drawElement: DrawElement) {\n  return { type: \"createDraftElement\", element: drawElement } as const;\n}\n\nfunction updateDraftElement<Type extends DrawElementType>(\n  props: Partial<DrawElementByType<Type>>\n) {\n  return { type: \"updateDraftElement\", props } as const;\n}\n\nfunction saveDraftElement() {\n  return { type: \"saveDraftElement\" } as const;\n}\n\nfunction updateScrollPoint(scrollPointShift: Point2D) {\n  return { type: \"updateScrollPoint\", scrollPointShift } as const;\n}\n\nfunction setActiveTool(tool: DrawElementType) {\n  return { type: \"setActiveTool\", tool } as const;\n}\n\nfunction setDrawElements(drawElements: DrawElement[]) {\n  return { type: \"setDrawElements\", drawElements } as const;\n}\n\nfunction setHoveredElement(drawElement: DrawElement | null) {\n  return { type: \"setHoveredElement\", drawElement } as const;\n}\n\nfunction dragHoveredDrawElement(shift: Point2D) {\n  return { type: \"dragHoveredDrawElement\", shift } as const;\n}\n\nfunction selectElement(drawElement: DrawElement | null) {\n  return { type: \"selectElement\", drawElement } as const;\n}\n\ntype Action =\n  | ReturnType<typeof createDraftElement>\n  | ReturnType<typeof saveDraftElement>\n  | ReturnType<typeof setActiveTool>\n  | ReturnType<typeof setDrawElements>\n  | ReturnType<typeof updateScrollPoint>\n  | ReturnType<typeof setHoveredElement>\n  | ReturnType<typeof dragHoveredDrawElement>\n  | ReturnType<typeof selectElement>\n  | ReturnType<typeof updateDraftElement>;\n\nfunction appReducer(state: AppState, action: Action): AppState {\n  switch (action.type) {\n    case \"createDraftElement\":\n      return {\n        ...state,\n        draftElement: action.element,\n        selectedElement: null,\n      };\n\n    case \"selectElement\":\n      return {\n        ...state,\n        selectedElement: action.drawElement,\n      };\n\n    case \"updateDraftElement\":\n      if (!state.draftElement) {\n        return state;\n      }\n      return {\n        ...state,\n        draftElement: {\n          ...state.draftElement,\n          props: {\n            ...state.draftElement.props,\n            ...action.props,\n          },\n        },\n      };\n\n    case \"saveDraftElement\":\n      if (!state.draftElement) {\n        return state;\n      }\n      return {\n        ...state,\n        drawElements: state.drawElements.concat(state.draftElement),\n        selectedElement: state.draftElement,\n        draftElement: null,\n      };\n\n    case \"setActiveTool\":\n      return {\n        ...state,\n        activeTool: action.tool,\n      };\n\n    case \"setDrawElements\":\n      return {\n        ...state,\n        drawElements: action.drawElements,\n      };\n\n    case \"updateScrollPoint\":\n      return {\n        ...state,\n        scrollPoint: [\n          state.scrollPoint[0] + action.scrollPointShift[0],\n          state.scrollPoint[1] + action.scrollPointShift[1],\n        ],\n      };\n\n    case \"setHoveredElement\":\n      return {\n        ...state,\n        hoveredElement: action.drawElement,\n      };\n\n    case \"dragHoveredDrawElement\": {\n      return {\n        ...state,\n        drawElements: state.drawElements.map((drawElement) => {\n          return drawElement;\n        }),\n      };\n    }\n  }\n}\n\nfunction useHistory<T>(state: T) {\n  const [history] = useState(() => StateHistory.of(state));\n  const [hasNext, setHasNext] = useState(history.hasNext());\n  const [hasPrev, setHasPrev] = useState(history.hasPrev());\n\n  useEffect(() => {\n    if (history.get() !== state) {\n      history.push(state);\n      setHasPrev(history.hasPrev());\n      setHasNext(history.hasNext());\n    }\n  }, [history, state]);\n\n  return {\n    hasPrev,\n    hasNext,\n    goBack() {\n      history.goBack();\n      setHasPrev(history.hasPrev());\n      setHasNext(history.hasNext());\n      return history.get();\n    },\n    goForward() {\n      history.goForward();\n      setHasPrev(history.hasPrev());\n      setHasNext(history.hasNext());\n      return history.get();\n    },\n  };\n}\n\nconst ORIGINAL_CURSOR_STYLE = \"crosshair\";\n\nfunction App() {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  const [state, dispatch] = useReducer(appReducer, initialState);\n\n  const history = useHistory(state.drawElements);\n\n  function goBack() {\n    if (history.hasPrev) {\n      const drawElements = history.goBack();\n      dispatch(setDrawElements(drawElements));\n    }\n  }\n\n  function goForward() {\n    if (history.hasNext) {\n      const drawElements = history.goForward();\n      dispatch(setDrawElements(drawElements));\n    }\n  }\n\n  useCanvasAutoResize(state, canvasRef);\n\n  const draftElementRef = useRef(state.draftElement);\n  draftElementRef.current = state.draftElement;\n\n  useEffect(() => {\n    const activeElementConfig = drawElementConfigRegistry[state.activeTool];\n\n    let lastClientX = 0;\n    let lastClientY = 0;\n\n    function handlePointerDown(ev: MouseEvent) {\n      if (ev.target !== canvasRef.current) {\n        return;\n      }\n\n      ev.preventDefault();\n\n      lastClientX = ev.clientX;\n      lastClientY = ev.clientY;\n\n      if (ev.buttons === 1) {\n        if (state.hoveredElement) {\n          document.addEventListener(\n            \"pointermove\",\n            handlePointerMoveWhileDragging\n          );\n          document.addEventListener(\"pointerup\", handlePointerUpWhileDragging);\n          return;\n        }\n\n        dispatch(\n          createDraftElement({\n            id: getId(),\n            type: state.activeTool,\n            props: activeElementConfig.onCreate(\n              ev.clientX - state.scrollPoint[0],\n              ev.clientY - state.scrollPoint[1]\n            ),\n          })\n        );\n        document.addEventListener(\"pointermove\", handlePointerMoveWhileDrawing);\n        document.addEventListener(\"pointerup\", handlePointerUpWhileDrawing);\n      }\n\n      if (ev.buttons === 4) {\n        if (canvasRef.current) canvasRef.current.style.cursor = \"grab\";\n        document.addEventListener(\n          \"pointermove\",\n          handlePointerMoveWhileScrolling\n        );\n        document.addEventListener(\"pointerup\", handlePointerUpWhileScrolling);\n      }\n    }\n\n    function handlePointerMoveWhileScrolling(ev: MouseEvent) {\n      const dx = ev.clientX - lastClientX;\n      const dy = ev.clientY - lastClientY;\n      dispatch(updateScrollPoint([dx, dy]));\n      lastClientX = ev.clientX;\n      lastClientY = ev.clientY;\n    }\n\n    function handlePointerUpWhileScrolling() {\n      if (canvasRef.current)\n        canvasRef.current.style.cursor = ORIGINAL_CURSOR_STYLE;\n      document.removeEventListener(\n        \"pointermove\",\n        handlePointerMoveWhileScrolling\n      );\n      document.removeEventListener(\"pointerup\", handlePointerUpWhileScrolling);\n    }\n\n    function handlePointerMoveWhileDragging(ev: MouseEvent) {\n      const dx = ev.clientX - lastClientX;\n      const dy = ev.clientY - lastClientY;\n      dispatch(dragHoveredDrawElement([dx, dy]));\n      lastClientX = ev.clientX;\n      lastClientY = ev.clientY;\n    }\n\n    function handlePointerUpWhileDragging() {\n      if (canvasRef.current)\n        canvasRef.current.style.cursor = ORIGINAL_CURSOR_STYLE;\n      dispatch(selectElement(state.hoveredElement));\n      document.removeEventListener(\n        \"pointermove\",\n        handlePointerMoveWhileDragging\n      );\n      document.removeEventListener(\"pointerup\", handlePointerUpWhileDragging);\n    }\n\n    function handlePointerMoveWhileDrawing(ev: MouseEvent) {\n      if (draftElementRef.current == null) {\n        return;\n      }\n      dispatch(\n        updateDraftElement(\n          activeElementConfig.onDrawing(\n            ev.clientX - lastClientX,\n            ev.clientY - lastClientY,\n            draftElementRef.current.props\n          )\n        )\n      );\n      lastClientX = ev.clientX;\n      lastClientY = ev.clientY;\n    }\n\n    function handlePointerUpWhileDrawing() {\n      dispatch(saveDraftElement());\n      document.removeEventListener(\n        \"pointermove\",\n        handlePointerMoveWhileDrawing\n      );\n      document.removeEventListener(\"pointerup\", handlePointerUpWhileDrawing);\n    }\n\n    function handleWheel(ev: WheelEvent) {\n      dispatch(updateScrollPoint([-ev.deltaX, -ev.deltaY]));\n    }\n\n    document.addEventListener(\"wheel\", handleWheel);\n\n    document.addEventListener(\"pointerdown\", handlePointerDown);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown);\n      document.removeEventListener(\"wheel\", handleWheel);\n    };\n  }, [state.activeTool, state.hoveredElement, state.scrollPoint]);\n\n  useEffect(() => {\n    const ctx = canvasRef.current?.getContext(\"2d\");\n    if (ctx == null) {\n      return;\n    }\n    drawScene(\n      ctx,\n      state.drawElements,\n      state.draftElement,\n      state.selectedElement,\n      state.scrollPoint\n    );\n  }, [\n    state.drawElements,\n    state.draftElement,\n    state.scrollPoint,\n    state.selectedElement,\n  ]);\n\n  function handleMouseMove(ev: React.MouseEvent) {\n    if (ev.target !== canvasRef.current) {\n      return;\n    }\n    const hoveredElement = getDrawElementAtPoint(state.drawElements, [\n      ev.clientX - state.scrollPoint[0],\n      ev.clientY - state.scrollPoint[1],\n    ]);\n    if (hoveredElement) canvasRef.current.style.cursor = \"move\";\n    else canvasRef.current.style.cursor = ORIGINAL_CURSOR_STYLE;\n    dispatch(setHoveredElement(hoveredElement));\n  }\n\n  return (\n    <div className=\"App\">\n      <Island className=\"App__toolbar\">\n        {elementTypes.map((elementType) => (\n          <button\n            key={elementType}\n            disabled={state.activeTool === elementType}\n            onClick={() => dispatch(setActiveTool(elementType))}\n          >\n            {elementType}\n          </button>\n        ))}\n      </Island>\n      <Island className=\"App__toolbar\">\n        <button disabled={!history.hasPrev} onClick={goBack}>\n          ←\n        </button>\n        <button disabled={!history.hasNext} onClick={goForward}>\n          →\n        </button>\n      </Island>\n      <canvas\n        className=\"App__canvas\"\n        ref={canvasRef}\n        onMouseMove={handleMouseMove}\n      ></canvas>\n    </div>\n  );\n}\n\nfunction getDrawElementAtPoint(\n  drawElements: DrawElement[],\n  point: Point2D\n): DrawElement | null {\n  let hoveredElement: DrawElement | null = null;\n\n  for (let i = drawElements.length - 1; i >= 0; i--) {\n    const element = drawElements[i];\n    const config = drawElementConfigRegistry[element.type];\n    if (config.containsPoint(element.props, point)) {\n      hoveredElement = element;\n      break;\n    }\n  }\n\n  return hoveredElement;\n}\n\nexport default App;\n\nfunction drawScene(\n  ctx: CanvasRenderingContext2D,\n  drawElements: DrawElement[],\n  draftElement: DrawElement | null,\n  selectedElement: DrawElement | null,\n  [scrollX, scrollY]: Point2D\n) {\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  ctx.translate(scrollX, scrollY);\n\n  drawElements.forEach((drawElement) => {\n    drawElementConfigRegistry[drawElement.type].draw(drawElement.props, ctx);\n  });\n  if (draftElement) {\n    drawElementConfigRegistry[draftElement.type].draw(draftElement.props, ctx);\n  }\n  if (selectedElement) {\n    drawBoundingBox(selectedElement, ctx);\n  }\n\n  ctx.translate(-scrollX, -scrollY);\n}\n\nconst BOUNDING_BOX_DELTA = 6;\nconst BOUNDING_BOX_LINE_DASH = [5, 5];\n\nfunction drawBoundingBox(\n  drawElement: DrawElement<keyof DrawElements>,\n  ctx: CanvasRenderingContext2D\n) {\n  ctx.save();\n  const boundingBox = drawElementConfigRegistry[\n    drawElement.type\n  ].getBoundingBox(drawElement.props);\n  ctx.lineWidth = 1;\n  ctx.strokeStyle = \"blue\";\n  ctx.setLineDash(BOUNDING_BOX_LINE_DASH);\n  ctx.strokeRect(\n    boundingBox.x - BOUNDING_BOX_DELTA,\n    boundingBox.y - BOUNDING_BOX_DELTA,\n    boundingBox.width + BOUNDING_BOX_DELTA * 2,\n    boundingBox.height + BOUNDING_BOX_DELTA * 2\n  );\n  ctx.restore();\n}\n\nfunction useCanvasAutoResize(\n  state: AppState,\n  canvasRef: RefObject<HTMLCanvasElement>\n) {\n  const lastState = useRef(state);\n  lastState.current = state;\n\n  useEffect(() => {\n    function resizeCanvas() {\n      const canvas = canvasRef.current;\n      if (!canvas) {\n        return;\n      }\n      const dpr = window.devicePixelRatio || 1;\n      canvas.width = window.innerWidth * dpr;\n      canvas.height = window.innerHeight * dpr;\n      canvas.style.width = window.innerWidth + \"px\";\n      canvas.style.height = window.innerHeight + \"px\";\n      const ctx = canvas.getContext(\"2d\");\n      if (ctx == null) {\n        return;\n      }\n      ctx.scale(dpr, dpr);\n      drawScene(\n        ctx,\n        lastState.current.drawElements,\n        lastState.current.draftElement,\n        lastState.current.selectedElement,\n        lastState.current.scrollPoint\n      );\n    }\n\n    window.addEventListener(\"resize\", resizeCanvas);\n    resizeCanvas();\n    return () => {\n      window.removeEventListener(\"resize\", resizeCanvas);\n    };\n  }, [canvasRef]);\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import getStroke from \"perfect-freehand\";\n\nfunction getSvgPathFromStroke(stroke: number[][]) {\n  if (!stroke.length) return \"\";\n\n  const d = stroke.reduce(\n    (acc, [x0, y0], i, arr) => {\n      const [x1, y1] = arr[(i + 1) % arr.length];\n      acc.push(x0, y0, (x0 + x1) / 2, (y0 + y1) / 2);\n      return acc;\n    },\n    [\"M\", ...stroke[0], \"Q\"]\n  );\n\n  d.push(\"Z\");\n  return d.join(\" \");\n}\n\nexport function freehandDraw(\n  points: Array<[x: number, y: number]>,\n  color: string,\n  ctx: CanvasRenderingContext2D\n) {\n  const pathData = getSvgPathFromStroke(getStroke(points));\n  ctx.fillStyle = color;\n  ctx.fill(new Path2D(pathData));\n}\n","import { createDrawElementConfig } from \"../draw-elements-drawer/DrawElementConfig\";\nimport { freehandDraw } from \"../freehand-draw\";\n\nexport interface Draw {\n  color: string;\n  points: Array<[x: number, y: number]>;\n}\n\ndeclare module \"./DrawElements\" {\n  interface DrawElements {\n    Draw: Draw;\n  }\n}\n\nexport const config = createDrawElementConfig({\n  name: \"Draw\",\n  draw(draw, ctx) {\n    if (draw.points.length === 0) {\n      return;\n    }\n    freehandDraw(draw.points, draw.color, ctx);\n  },\n  onCreate(x, y) {\n    return {\n      color: \"black\",\n      points: [[x, y]],\n    };\n  },\n  onDrawing(dx, dy, draw) {\n    const [x, y] = draw.points[draw.points.length - 1];\n    return {\n      points: [...draw.points, [x + dx, y + dy]] as Array<[number, number]>,\n    };\n  },\n  getBoundingBox(draw) {\n    const x = Math.min(...draw.points.map((p) => p[0]));\n    const y = Math.min(...draw.points.map((p) => p[1]));\n    return {\n      x: x,\n      y: y,\n      width: Math.max(...draw.points.map((p) => p[0])) - x,\n      height: Math.max(...draw.points.map((p) => p[1])) - y,\n    };\n  },\n  containsPoint(draw, [x, y]) {\n    const x0 = Math.min(...draw.points.map((p) => p[0]));\n    const y0 = Math.min(...draw.points.map((p) => p[1]));\n    const x1 = Math.max(...draw.points.map((p) => p[0]));\n    const y1 = Math.max(...draw.points.map((p) => p[1]));\n    return (\n      Math.min(x0, x1) <= x &&\n      Math.max(x0, x1) >= x &&\n      Math.min(y0, y1) <= y &&\n      Math.max(y0, y1) >= y\n    );\n  },\n});\n"],"sourceRoot":""}